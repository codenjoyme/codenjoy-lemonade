<meta charset="UTF-8">

## Вступление

Игровой demo-сервер доступен так же в интернете 24/7 в целях
ознакомления [http://codenjoy.com/codenjoy-contest](http://codenjoy.com/codenjoy-contest).

Игра с открытым исходным кодом. Для реализации своей игры, исправления
ошибок в текущей и внесения других правок необходимо для начала
[форкнуть проект](https://github.com/codenjoyme/codenjoy.git).
В корне репозитория есть описание в файле Readme.md - там описано, что делать дальше.

По возникающим вопросам, пиши в [skype alexander.baglay](skype:alexander.baglay)
или на почту [apofig@gmail.com](mailto:apofig@gmail.com).

Первоначальная версия игры Lemonade Stand была создана Bob Jamison в 
1973 году для мэйнфреймов, затем в 1979 году Charlie Kellner портировал 
её на домашний компьютер Apple II. Предлагаемая вам версия игры основана
на исходном коде игры 1979 года, написанном на Applesoft BASIC.

## В чем суть игры?

<pre>HI! WELCOME TO LEMONSVILLE, CALIFORNIA!
IN THIS SMALL TOWN, YOU ARE IN CHARGE OF RUNNING YOUR OWN LEMONADE STAND.
HOW MUCH PROFIT YOU MAKE IS UP TO YOU.
IF YOU MAKE THE MOST MONEY, YOU'RE THE WINNER!!
TO MANAGE YOUR LEMONADE STAND, YOU WILL NEED TO MAKE THESE DECISIONS EVERY DAY:
1. HOW MANY GLASSES OF LEMONADE TO MAKE (ONLY ONE BATCH IS MADE EACH MORNING)
2. HOW MANY ADVERTISING SIGNS TO MAKE (THE SIGNS COST FIFTEEN CENTS EACH)
3. WHAT PRICE TO CHARGE FOR EACH GLASS
YOU WILL BEGIN WITH $2.00 CASH (ASSETS).
BECAUSE YOUR MOTHER GAVE YOU SOME SUGAR,YOUR COST TO MAKE LEMONADE IS
$0.02 (TWO CENTS A GLASS, THIS MAY CHANGE IN THE FUTURE).
YOUR EXPENSES ARE THE SUM OF THE COST OF THE LEMONADE AND THE COST OF THE SIGNS.
YOUR PROFITS ARE THE DIFFERENCE BETWEEN THE INCOME FROM SALES AND YOUR EXPENSES.
THE NUMBER OF GLASSES YOU SELL EACH DAY DEPENDS ON THE PRICE YOU CHARGE, AND ON
THE NUMBER OF ADVERTISING SIGNS YOU USE.
KEEP TRACK OF YOUR ASSETS, BECAUSE YOU CAN'T SPEND MORE MONEY THAN YOU HAVE!</pre>

В этой игре вы принимаете на себя роль школьника, который подрабатывает 
на каникулах, продавая на улице лимонад. С утра вы готовите лимонад 
и рекламные плакаты и в течение всего дня продаёте приготовленный объём напитка.
У вас есть начальный капитал в размере $2.00 (величина A<sub>0</sub>).
Стоимость стакана лимонада для вас составляет всего $0.02 (C), но со 
временем эта величина может измениться. На каждом ходу вам нужно решить, 
как потратить имеющиеся деньги, и вы выражаете своё решение, сообщая 
компьютеру три числа:

* L = Сколько стаканов лимонада вы приготовите этим утром (`glasses made`, 
  целое число от 0 до 1000)
* S = Сколько рекламных плакатов вы установите в округе, каждый плакат 
  стоит для вас $0.15 (`signs made`, целое число от 0 до 50)
* P = Цена, которую вы просите за каждый стакан (`price`, цена в центах, 
  целое число от 0 до 100)

Результатом для вас является финансовый отчёт, который показывает:

* E = S &times; 0.15 &plus; L &times; C = расходы на изготовление 
  рекламных плакатов и приготовление лимонада (`expenses`);
* N = сколько стаканов было продано (`glasses sold`);
* M = N &times; P = доход (`income`);
* M &minus; E = полученная прибыль (`profit`);
* A<sub>n+1</sub> = A<sub>n</sub> &plus; (M &minus; E) = твой капитал 
  после сегодняшнего дня (`assets`).

Величина N (сколько стаканов распродано) зависит от рекламы, цены за 
стакан, погоды, а также от некоторых случайных факторов. В начале каждого 
дня вам сообщают прогноз погоды, но погода в течение дня может и поменяться.

## Подключение к серверу

Итак, игрок [регистрируется на сервере](../../../register?gameName=lemonade),
указывая свой email.

Далее необходимо подключиться из кода к серверу через websocket.
[Эта подборка](https://github.com/codenjoyme/codenjoy-clients.git)
клиентов для разных языков программирования тебе поможет в твоей игре.
Как запустить клиент смотри в корне проекта в файле README.md.

Если ты не можешь найти свой язык - придется написать свой клиент
(а после пошарить с нами на почту [apofig@gmail.com](mailto:apofig@gmail.com))

Адрес для подключения к игре на сервере выглядит так (ты можешь скопировать его
из игровой комнаты):

`https://[server]/codenjoy-contest/board/player/[user]?code=[code]`

Тут `[server]` - домен или ip-адрес игрового сервера, `[user]` - id игрока, a `[code]` -
твой security token. Убедись что код хранится в тайне, иначе любой участник
сможет играть от твоего имени.

В коде твоего клиента тебе нужно найти похожую строчку и заменить её твоим URL -
тем самым, ты задаёшь логин/пароль для доступа к серверу.
Затем запусти твой клиент и убедись, что сервер получает команды твоего клиента.
После этого можно приступать к работе над логикой бота.

## Формат сообщений

Как и в других играх на платформе Codenjoy, здесь вы играете не сами, 
за вас играет твой игровой бот - написанная вами программа. Ваш бот 
обменивается сообщениями с сервером. За каждый ход твой бот получает 
описание текущей ситуации от сервера и должен передать ему команду.
В данной игре описание игровой ситуации включает две части:

* (В первый день) Приветственное сообщение с описанием игры
  (см. выше текст "<span style="font-family: monospace">HI! WELCOME TO LEMONSVILLE, CALIFORNIA!</span>").
  (В любой другой день) Финансовый отчёт за предыдущий день.
* Прогноз на утро нового дня.

Пример того, как может выглядеть сообщение о результатах первого дня 
плюс прогноз на второй день:

<pre>** LEMONSVILLE DAILY FINANCIAL REPORT, DAY 1 **
GLASSES SOLD: 10, PRICE $0.20 PER GLASS
INCOME:   $2.00
GLASSES MADE: 10, SIGNS MADE: 2
EXPENSES: $0.50
PROFIT:   $1.50
ASSETS:   $3.50                                
YOUR ASSETS: $3.50
LEMONSVILLE WEATHER REPORT:  CLOUDY
ON DAY 2, THE COST OF LEMONADE IS $0.02</pre>

## Пример поля

Эту информацию бот получает в виде JSON, который имеет вид
(строка messages здесь разделена на отдельные строки для 
удобства просмотра, значения не обязательно передаются в этом порядке):

<pre>{
  "lemonadeCost": 0.02,
  "assets": 3.5,
  "weatherForecast": "CLOUDY",
  "isBankrupt": false,
  "isGameOver": false,
  "messages": "** LEMONSVILLE DAILY FINANCIAL REPORT, DAY 1 **\n
    GLASSES SOLD: 10, PRICE $0.20 PER GLASS\nINCOME:   $2.00\n
    GLASSES MADE: 10, SIGNS MADE: 2\nEXPENSES: $0.50\n
    PROFIT:   $1.50\nASSETS:   $3.50\n\n
    YOUR ASSETS: $3.50\n
    LEMONSVILLE WEATHER REPORT:  CLOUDY\n
    ON DAY 2, THE COST OF LEMONADE IS $0.02\n",
  "history": [
    {
      "income": 2,
      "signsMade": 2,
      "lemonadeSold": 10,
      "lemonadeMade": 10,
      "assetsAfter": 3.5,
      "day": 1,
      "profit": 1.5,
      "lemonadePrice": 0.2,
      "assetsBefore": 2,
      "expenses": 0.5
    },
  ],
  "day": 2
}</pre>

* `day` - номер текущего дня;
* `assets` - сколько у вас сейчас есть денег;
* `isBankrupt` - признак того, что вы банкрот, то есть имеющихся денег не 
   хватает на приготовление одного стакана лимонада;
* `isGameOver` - признак того, что игра окончена, то есть либо вы банкрот, 
  либо вы дошли до конца игры и победили;
* `messages` - все сообщения от сервера, для первого дня здесь будет 
  приветственное сообщение и прогноз на текущий день;
  для второго и последующих дней здесь будет финансовый отчёт за день 
  (day &minus; 1) и прогноз на текущий день;
  обращайте внимание на это поле, там могут быть неожиданности;
* `lemonadeCost` - стоимость стакана лимонада для вас на сегодняшний день;
* `weatherForecast` - прогноз погоды на сегодняшний день;
* `history` - история за последние 10 дней.
 
Игровой экран на странице игры выглядит примерно так:

![](board.png)

Здесь слева вверху выведены сообщения от сервера (messages),
справа внизу рисунок показывает прогноз погоды на сегодня, номер дня `day` 
и текущую сумму денег `assets`, слева внизу находится график истории 
изменения суммы денег `assets` за последние 10 дней.

## Как играть?

Игра пошаговая, каждую секунду сервер посылает твоему клиенту
состояние игры на текущий момент и ожидает команды. 
За следующую секунду игрок должен успеть дать команду. 

Твоя цель вести игру в соответствии с задуманным тобой алгоритмом.
Игрок должен уметь зарабатывать так много очков, как только сможет.
Основная цель игры - обыграть по очкам всех соперников.

## Команды управления

Получив информацию от сервера, твой бот должен отправить команду вида:

`message('go 2,1,15')`

Где три числа это: сколько стаканов лимонада приготовить, сколько сделать
рекламных плакатов, сколько будет стоить стакан лимонада.

В случае, когда вы достигли конца игры, твой бот должен отправить команду вида:

`message('go reset')`,

чтобы начать игру заново.

## Настройки

Параметры будут меняться[*](index.md#ask) по ходу игры.

## Кейзы

## <a id="ask"></a> Спроси Сенсея

Параметры могут изменяться по ходу игры. Настройки текущей игры
ты сможешь всегда [подглядеть тут](/codenjoy-contest/rest/settings/player).
Пожалуйста, спроси у Сенсея как интерпретировать эти данные. Ты можешь найти Сенсея
в чате, который подготовили организаторы для обсуждения вопросов.

## Подсказки

Первостепенная задача – написать websocket клиента, который подключится
к серверу. Затем заставить сервер слушаться команд.
Таким образом, игрок подготовится к основной игре.
Основная цель – вести осмысленную игру и победить.

## Клиент и API

Организаторы предоставляют игрокам подготовленные клиенты в исходном 
коде на нескольких языках. Каждый из этих клиентов уже умеет связываться 
с сервером, принимать и разбирать сообщение от сервера (обычно это называется board)
и отправлять серверу команды.

Слишком много форы клиентский код не дает играющим, поскольку в этом коде
еще надо разобраться, но там реализована логика общения с сервером +
некоторое высокоуровневое API для работы с доской (что уже приятно).

## Как провести такой же ивент самостоятельно?

Перед тобой opensource проект. Для реализации своей новой игры, модификации этой игры,
любой другой модификации сервера или исправления найденной ошибки
[форкни проект](https://github.com/codenjoyme/codenjoy.git).
Все инструкции ты найдешь в Readme.md файлах - они подскажут, что делать дальше.

Если у тебя есть вопросы - прошу, задавай их мне
в [скайпе alexander.baglay](skype:alexander.baglay)
или по почте [apofig@gmail.com](mailto:apofig@gmail.com).

Удачной игры и пусть победит сильнейший! 